<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalStorage Temizleme</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        .btn { padding: 15px 30px; margin: 10px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        .btn:hover { background: #c82333; }
        .success { background: #28a745; }
        .success:hover { background: #218838; }
        .result { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #007bff; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .warning { border-left-color: #ffc107; background: #fff3cd; }
        pre { background: #f1f1f1; padding: 10px; border-radius: 3px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <h1>ğŸ§¹ LocalStorage Temizleme AracÄ±</h1>
    
    <div class="warning result">
        <strong>âš ï¸ DÄ°KKAT:</strong> Bu iÅŸlem tÃ¼m localStorage verilerini kalÄ±cÄ± olarak silecektir!
    </div>

    <div>
        <h3>1. Mevcut LocalStorage Ä°Ã§eriÄŸi</h3>
        <button class="btn success" onclick="checkCurrentStorage()">ğŸ“‹ Mevcut Verileri GÃ¶ster</button>
        <div id="currentStorage"></div>
    </div>

    <div>
        <h3>2. LocalStorage Temizleme</h3>
        <button class="btn" onclick="clearAllStorage()">ğŸ—‘ï¸ TÃœM VERÄ°LERÄ° SÄ°L</button>
        <button class="btn success" onclick="clearUserDataOnly()">ğŸ‘¤ Sadece KullanÄ±cÄ± Verilerini Sil</button>
        <div id="clearResult"></div>
    </div>

    <div>
        <h3>3. TarayÄ±cÄ± Cache Temizleme</h3>
        <button class="btn" onclick="clearBrowserCache()">ğŸ§½ TarayÄ±cÄ± Cache Temizle</button>
        <div id="cacheResult"></div>
    </div>

    <div>
        <h3>4. Kontrol</h3>
        <button class="btn success" onclick="verifyClearing()">âœ… Temizleme DoÄŸrula</button>
        <div id="verifyResult"></div>
    </div>

    <script>
        function checkCurrentStorage() {
            const result = document.getElementById('currentStorage');
            const storageData = {};
            const storageSize = localStorage.length;
            
            console.log('ğŸ“Š LocalStorage Key SayÄ±sÄ±:', storageSize);
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                storageData[key] = value ? value.substring(0, 100) + (value.length > 100 ? '...' : '') : null;
                console.log(`ğŸ“‹ ${key}:`, value);
            }
            
            result.innerHTML = `
                <div class="result">
                    <strong>ğŸ“Š LocalStorage Ä°Ã§eriÄŸi (${storageSize} adet):</strong><br><br>
                    <pre>${JSON.stringify(storageData, null, 2)}</pre>
                </div>
            `;
        }

        function clearAllStorage() {
            const result = document.getElementById('clearResult');
            const initialCount = localStorage.length;
            
            console.log('ğŸ§¹ TÃ¼m localStorage temizleniyor...');
            console.log('ğŸ“Š Temizlik Ã¶ncesi key sayÄ±sÄ±:', initialCount);
            
            // Clear localStorage
            localStorage.clear();
            
            // Also clear sessionStorage
            sessionStorage.clear();
            
            // Verify clearing
            const finalCount = localStorage.length;
            
            console.log('ğŸ“Š Temizlik sonrasÄ± key sayÄ±sÄ±:', finalCount);
            
            result.innerHTML = `
                <div class="result ${finalCount === 0 ? 'success' : 'error'}">
                    <strong>${finalCount === 0 ? 'âœ… BAÅARILI' : 'âŒ BAÅARISIZ'}</strong><br>
                    Temizlik Ã¶ncesi: ${initialCount} adet<br>
                    Temizlik sonrasÄ±: ${finalCount} adet<br><br>
                    ${finalCount === 0 ? 
                        'ğŸ‰ TÃ¼m localStorage verileri baÅŸarÄ±yla silindi!' : 
                        'âš ï¸ BazÄ± veriler silinemedi. TarayÄ±cÄ±yÄ± yeniden baÅŸlatmayÄ± deneyin.'
                    }
                </div>
            `;
        }

        function clearUserDataOnly() {
            const result = document.getElementById('clearResult');
            const userKeys = [
                'mockUsers',
                'mockActivities', 
                'currentUser',
                'users',
                'activities',
                'userData',
                'userProfiles',
                'demoUsers',
                'supabase_config'
            ];
            
            let removedCount = 0;
            const removedKeys = [];
            
            console.log('ğŸ‘¤ KullanÄ±cÄ± verileri temizleniyor...');
            
            userKeys.forEach(key => {
                if (localStorage.getItem(key)) {
                    localStorage.removeItem(key);
                    removedKeys.push(key);
                    removedCount++;
                    console.log(`âœ… ${key} silindi`);
                }
            });
            
            // Also clear session storage user data
            sessionStorage.removeItem('currentUser');
            
            result.innerHTML = `
                <div class="result success">
                    <strong>âœ… KullanÄ±cÄ± Verileri Temizlendi</strong><br>
                    Silinen key sayÄ±sÄ±: ${removedCount}<br>
                    Silinen keyler: ${removedKeys.join(', ') || 'HiÃ§biri'}<br><br>
                    ğŸ§¹ SessionStorage'dan currentUser da silindi
                </div>
            `;
        }

        function clearBrowserCache() {
            const result = document.getElementById('cacheResult');
            
            // Force reload all resources
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    for(let registration of registrations) {
                        registration.unregister();
                    }
                });
            }
            
            result.innerHTML = `
                <div class="result">
                    <strong>ğŸ§½ TarayÄ±cÄ± Cache Temizleme</strong><br><br>
                    âœ… Service Worker registration temizlendi<br>
                    ğŸ“ Manuel adÄ±mlar:<br>
                    â€¢ F12 > Application > Storage > Clear storage<br>
                    â€¢ Ctrl+Shift+R (Hard refresh)<br>
                    â€¢ Ctrl+Shift+Delete (TarayÄ±cÄ± temizleme)
                </div>
            `;
        }

        function verifyClearing() {
            const result = document.getElementById('verifyResult');
            const currentCount = localStorage.length;
            const sessionCount = sessionStorage.length;
            
            const userKeys = ['mockUsers', 'mockActivities', 'currentUser', 'users', 'activities', 'userData'];
            const remainingUserKeys = userKeys.filter(key => 
                localStorage.getItem(key) || sessionStorage.getItem(key)
            );
            
            const isClean = currentCount === 0 || remainingUserKeys.length === 0;
            
            result.innerHTML = `
                <div class="result ${isClean ? 'success' : 'error'}">
                    <strong>${isClean ? 'âœ… TEMÄ°Z' : 'âš ï¸ HALA VERÄ° VAR'}</strong><br><br>
                    ğŸ“Š LocalStorage: ${currentCount} key<br>
                    ğŸ“Š SessionStorage: ${sessionCount} key<br>
                    ğŸ‘¤ Kalan kullanÄ±cÄ± verileri: ${remainingUserKeys.join(', ') || 'Yok'}<br><br>
                    ${isClean ? 
                        'ğŸ‰ Sistem temiz! ArtÄ±k sadece Supabase kullanÄ±lacak.' :
                        'ğŸ”„ SayfayÄ± yenileyin veya tarayÄ±cÄ±yÄ± yeniden baÅŸlatÄ±n.'
                    }
                </div>
            `;
        }

        // Auto-check on load
        window.addEventListener('load', function() {
            setTimeout(checkCurrentStorage, 500);
        });
    </script>
</body>
</html>